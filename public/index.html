<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>실시간 뉴스 + 음성</title>
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
      color: white;
      font-size: 28px;
      font-weight: bold;
      text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
    }
    #wrapper {
      white-space: nowrap;
      overflow: hidden;
      position: relative;
      width: 100vw;
      height: 40px;
    }
    #news {
      display: inline-block;
      padding-left: 100vw;
    }
  </style>
</head>
<body>
  <div id="wrapper">
    <div id="news">뉴스 로딩 중...</div>
  </div>

  <script>
    const API_URL = "https://proxy2-production-fe60.up.railway.app"; 
    const newsEl = document.getElementById("news");
    let animationFrame;
    let pos = window.innerWidth;

    async function loadNews() {
      try {
        const res = await fetch(API_URL + "/news");
        const data = await res.json();
        if (data.news) {
          startScroll(data.news);
          playTTS();
        }
      } catch (err) {
        console.error("뉴스 불러오기 실패", err);
        setTimeout(loadNews, 5000); // 실패 시 5초 후 재시도
      }
    }

    function startScroll(text) {
      cancelAnimationFrame(animationFrame);
      newsEl.textContent = text;
      pos = window.innerWidth;
      scrollStep();
    }

    function scrollStep() {
      pos -= 2;
      if (pos < -newsEl.offsetWidth) {
        loadNews();
        return;
      }
      newsEl.style.transform = `translateX(${pos}px)`;
      animationFrame = requestAnimationFrame(scrollStep);
    }

    function playTTS() {
      const audio = new Audio(API_URL + "/tts?t=" + Date.now());
      audio.play().catch(err => console.log("🔇 자동재생 차단됨:", err));
    }

    // 초기 실행
    loadNews();
  </script>
</body>
</html>
