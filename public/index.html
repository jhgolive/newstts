<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì‹¤ì‹œê°„ ë‰´ìŠ¤ + ìŒì„±</title>
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
      color: white;
      font-size: 28px;
      font-weight: bold;
      text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
    }
    #wrapper {
      white-space: nowrap;
      overflow: hidden;
      position: relative;
      width: 100vw;
      height: 40px;
    }
    #news {
      display: inline-block;
      padding-left: 100vw;
    }
  </style>
</head>
<body>
  <div id="wrapper">
    <div id="news">ë‰´ìŠ¤ ë¡œë”© ì¤‘...</div>
  </div>

  <script>
    // âœ… Railway ì„œë²„ ì£¼ì†Œ ì…ë ¥
    const API_URL = "https://proxy2-production-fe60.up.railway.app"; 

    const newsEl = document.getElementById("news");
    let animationFrame;
    let pos = window.innerWidth;

    async function loadNews() {
      try {
        const res = await fetch(API_URL + "/news");
        const data = await res.json();
        if (data.news) {
          startScroll(data.news);
          playTTS(); // ìŒì„± ìë™ ì‹¤í–‰
        }
      } catch (err) {
        console.error("ë‰´ìŠ¤ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨", err);
      }
    }

    function startScroll(text) {
      cancelAnimationFrame(animationFrame);
      newsEl.textContent = text;
      pos = window.innerWidth;
      scrollStep();
    }

    function scrollStep() {
      pos -= 2; // ìŠ¤í¬ë¡¤ ì†ë„
      if (pos < -newsEl.offsetWidth) {
        loadNews(); // í•œ ì¤„ ëë‚˜ë©´ ìƒˆë¡œìš´ ë‰´ìŠ¤
        return;
      }
      newsEl.style.transform = `translateX(${pos}px)`;
      animationFrame = requestAnimationFrame(scrollStep);
    }

    function playTTS() {
      const audio = new Audio(API_URL + "/tts?t=" + Date.now());
      audio.play().catch(err => console.log("ğŸ”‡ ìë™ì¬ìƒ ì°¨ë‹¨ë¨:", err));
    }

    // ì´ˆê¸° ì‹¤í–‰
    loadNews();
  </script>
</body>
</html>
